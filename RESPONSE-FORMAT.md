# פורמט התגובות מה-API - מסמך מפרט

## מבנה התגובה הבסיסי

כל תגובה מהשרת חייבת להיות בפורמט הבא **בדיוק**:

```json
{
  "StatusId": 1,
  "StatusDescription": "Success",
  "sender": "972504200742",
  "messages": [...],
  "control": {...}  // אופציונלי
}
```

### שדות ראשיים (Case-Sensitive!)

| שדה | סוג | חובה | תיאור |
|-----|-----|------|-------|
| `StatusId` | Number | ✅ | 1 = הצלחה, 0 = שגיאה |
| `StatusDescription` | String | ✅ | תיאור הסטטוס (למשל: "Success") |
| `sender` | String | ✅ | מספר השולח |
| `messages` | Array | ✅ | מערך של הודעות |
| `control` | Object | ❌ | אובייקט בקרה (רק כאשר מחכים לקלט) |

---

## סוגי הודעות (Messages)

### 1️⃣ הודעת טקסט (Text)

```json
{
  "type": "Text",
  "text": "תוכן ההודעה כאן",
  "created": "2025-11-26 14:16:11"
}
```

**שדות:**
- `type`: **חייב** להיות `"Text"` (T גדולה!)
- `text`: תוכן ההודעה
- `created`: תאריך ושעה ביצירה

**⚠️ חשוב:** 
- אין שדה `options` במסר טקסט!
- אם רוצים טקסט + תפריט, שולחים **שני מסרים נפרדים**

---

### 2️⃣ הודעת תפריט (Options)

```json
{
  "type": "Options",
  "options": [
    {
      "label": "אפשרות 1",
      "value": "אפשרות 1",
      "image_url": "https://example.com/img.jpg"  // אופציונלי
    },
    {
      "label": "אפשרות 2",
      "value": "אפשרות 2"
    }
  ],
  "created": "2025-11-26 14:16:11"
}
```

**שדות:**
- `type`: **חייב** להיות `"Options"` (O גדולה!)
- `options`: מערך של אובייקטים, כל אחד עם:
  - `label`: הטקסט המוצג
  - `value`: הערך שנשלח כשבוחרים
  - `image_url`: (אופציונלי) קישור לתמונה
- `created`: תאריך ושעה ביצירה

**⚠️ חשוב מאוד:** 
- **אין שדה `text` במסר Options!**
- אם יש טקסט שצריך להופיע לפני התפריט, שולחים אותו **במסר Text נפרד לפני**

**דוגמה נכונה - טקסט + תפריט:**
```json
{
  "messages": [
    {
      "type": "Text",
      "text": "ברוכים הבאים, בחר אפשרות:",
      "created": "2025-11-26 14:16:11"
    },
    {
      "type": "Options",
      "options": [...],
      "created": "2025-11-26 14:16:11"
    }
  ]
}
```

---

### 3️⃣ הודעת תמונה (Image)

```json
{
  "type": "Image",
  "url": "https://example.com/image.jpg",
  "created": "2025-11-26 14:16:11"
}
```

**שדות:**
- `type`: **חייב** להיות `"Image"` (I גדולה!)
- `url`: כתובת התמונה
- `created`: תאריך ושעה ביצירה

---

### 4️⃣ הודעת קישור (URL)

```json
{
  "type": "URL",
  "text": "לחץ כאן",
  "url": "https://example.com",
  "created": "2025-11-26 14:16:11"
}
```

**שדות:**
- `type`: **חייב** להיות `"URL"` (כולו גדולות!)
- `text`: הטקסט של הקישור
- `url`: כתובת ה-URL
- `created`: תאריך ושעה ביצירה

---

## אובייקט Control

מופיע רק כאשר הבוט מחכה לקלט מהמשתמש:

```json
{
  "type": "InputText",
  "name": "customerName"
}
```

**שדות:**
- `type`: **חייב** להיות `"InputText"` (I ו-T גדולות!)
- `name`: שם המשתנה שהקלט יישמר בו

---

## דוגמה מלאה - טקסט + תפריט

זו הדוגמה המלאה שלך:

```json
{
  "StatusId": 1,
  "StatusDescription": "Success",
  "sender": "972504200742",
  "messages": [
    {
      "type": "Text",
      "text": "ברוכים הבאים לקופרוויז'ן - מובילה עולמית בהאטת קוצר ראייה אצל ילדים; **המשווקת את משקפי מייסייט לילדים החל מגיל 6.",
      "created": "2025-11-26 14:16:11"
    },
    {
      "type": "Options",
      "options": [
        { "label": "אפשרות 1", "value": "אפשרות 1" },
        { "label": "אפשרות 2", "value": "אפשרות 2" }
      ],
      "created": "2025-11-26 14:16:11"
    }
  ],
  "control": {
    "type": "InputText",
    "name": "menu2"
  }
}
```

---

## רשימת בדיקה (Checklist)

### שדות ראשיים
- [ ] `StatusId` (I ו-D גדולות) - מספר
- [ ] `StatusDescription` (S, I, D גדולות) - מחרוזת
- [ ] `sender` (כולו קטן) - מחרוזת
- [ ] `messages` (כולו קטן) - מערך

### הודעת Text
- [ ] `type: "Text"` (T גדולה)
- [ ] `text` (כולו קטן)
- [ ] `created` (כולו קטן)
- [ ] **אין** שדה `options`

### הודעת Options
- [ ] `type: "Options"` (O גדולה)
- [ ] `options` (כולו קטן) - מערך
- [ ] `created` (כולו קטן)
- [ ] **אין** שדה `text`
- [ ] כל אפשרות יש לה `label` ו-`value`
- [ ] `image_url` אם יש תמונה (i, u קטנות, קו תחתון)

### הודעת Image
- [ ] `type: "Image"` (I גדולה)
- [ ] `url` (כולו קטן)
- [ ] `created` (כולו קטן)

### הודעת URL
- [ ] `type: "URL"` (כולו גדולות)
- [ ] `text` (כולו קטן)
- [ ] `url` (כולו קטן)
- [ ] `created` (כולו קטן)

### אובייקט Control
- [ ] `type: "InputText"` (I ו-T גדולות)
- [ ] `name` (כולו קטן)

---

## שגיאות נפוצות ❌

### ❌ שגיאה 1: טקסט בתוך Options
```json
// ❌ לא נכון!
{
  "type": "Options",
  "text": "בחר אפשרות",  // לא צריך!
  "options": [...]
}
```

```json
// ✅ נכון!
{
  "messages": [
    { "type": "Text", "text": "בחר אפשרות", ... },
    { "type": "Options", "options": [...], ... }
  ]
}
```

### ❌ שגיאה 2: אותיות גדולות/קטנות שגויות
```json
// ❌ לא נכון!
{
  "statusId": 1,  // צריך StatusId
  "Messages": [...],  // צריך messages
  "control": { "type": "inputText" }  // צריך InputText
}
```

### ❌ שגיאה 3: שדות חסרים
```json
// ❌ לא נכון!
{
  "type": "Options",
  "options": [
    { "label": "אפשרות 1" }  // חסר value!
  ]
}
```

---

## קובץ בדיקה

להרצת בדיקה מלאה:
```bash
node backend/test-response-format.js
```

הסקריפט יבדוק:
1. ✅ כל השדות הראשיים קיימים
2. ✅ אותיות גדולות/קטנות נכונות
3. ✅ סוגי השדות נכונים
4. ✅ כל מסר בפורמט הנכון
5. ✅ אין שדות מיותרים

---

**עודכן לאחרונה:** 9 פברואר 2026
